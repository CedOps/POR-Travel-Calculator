<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ADT Travel Calculator</title>

<link href="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css" rel="stylesheet" />
<script src="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>

<link rel="stylesheet" href="https://unpkg.com/@mapbox/mapbox-gl-geocoder@5.0.1/dist/mapbox-gl-geocoder.css" />
<script src="https://unpkg.com/@mapbox/mapbox-gl-geocoder@5.0.1/dist/mapbox-gl-geocoder.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6.5.0/turf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
  html,body{height:100%;margin:0}
  #map{position:absolute;inset:0}
  #status{
    position:fixed;left:8px;top:8px;z-index:1000;background:#fff;border:1px solid #e5e7eb;border-radius:12px;
    padding:10px 12px;font:13px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Arial;box-shadow:0 1px 6px rgba(0,0,0,.12);max-width:860px;
  }
  #status .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:4px 0}
  #status .pill{border:1px solid #e5e7eb;border-radius:999px;padding:3px 8px;font-size:12px}
  #status .ok{color:#065f46;background:#d1fae5;border-color:#10b981}
  #status .warn{color:#7f1d1d;background:#fee2e2;border-color:#ef4444}
  #status .muted{color:#6b7280;font-size:12px}
  #status b{font-weight:600}
  .u{text-decoration:underline}

  /* Cost pill */
  .cost-pill{
    border-color:#60a5fa;background:#eff6ff;
    box-shadow: inset 0 0 0 1px rgba(96,165,250,.25);
    display:flex; align-items:center; gap:6px;
  }
  .cost-main{font-weight:700}
  .cost-sub{color:#6b7280;font-size:12px;margin-left:6px}
  .cost-zero{background:#f3f4f6;border-color:#d1d5db;box-shadow: inset 0 0 0 1px rgba(0,0,0,.04);color:#374151}
  .cost-pay{background:#fffbeb;border-color:#f59e0b;box-shadow: inset 0 0 0 1px rgba(245,158,11,.25);color:#7c2d12}

  /* Alternates */
  details.alt{margin-top:6px;border-top:1px dashed #e5e7eb;padding-top:6px}
  details.alt > summary{
    cursor:pointer; list-style:none; padding:4px 8px; border-radius:8px;
    border:1px solid #e5e7eb; display:flex; align-items:center; gap:8px;
    background:#f9fafb;
  }
  details.alt[open] > summary{background:#eef2ff;border-color:#c7d2fe}
  .alt-body{margin:8px 0 2px 0; padding:8px; border:1px solid #eef2f7; border-radius:8px; background:#fff}
  .chips{margin-top:6px}

  .alts-sep{border:0;border-top:2px solid #e5e7eb;margin:8px 0 6px}

  .rate-ctrl{
    display:flex; align-items:center; gap:6px;
    background:#fff; padding:6px 8px; border:1px solid #e5e7eb; border-radius:8px;
    box-shadow:0 1px 6px rgba(0,0,0,.08);
    font:12px system-ui,-apple-system,Segoe UI,Roboto,Arial;
    margin-top:6px;
  }
  .rate-ctrl label{color:#374151; font-size:12px}
  .rate-ctrl select{font-size:12px; padding:4px 6px; border-radius:8px; border:1px solid #d1d5db; background:#fff}

  .mapboxgl-ctrl-top-right .mapboxgl-ctrl-geocoder { width: 540px; min-width: 540px; max-width: 640px; }
  @media (max-width: 800px) {
    .mapboxgl-ctrl-top-right .mapboxgl-ctrl-geocoder { width: 90vw; min-width: 0; max-width: 90vw; }
  }

  /* Toast */
  #toast{
    position:fixed; left:50%; bottom:16px; transform:translateX(-50%);
    background:#111827; color:#fff; padding:8px 12px; border-radius:10px;
    font:12px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial;
    opacity:0; pointer-events:none; z-index:10000;
    box-shadow:0 8px 24px rgba(0,0,0,.25); transition:opacity .25s ease;
    max-width:90vw; word-break:break-word;
  }
  #toast.show{opacity:0.95}

  /* Red Instructions row */
  #status .instr { color:#7f1d1d; }

  /* Copy button (press feedback) */
  .copy-btn {
    background: none;
    border: none;
    cursor: pointer;
    margin-left: 8px;
    display: flex;
    align-items: center;
    color: #374151;
    transition: transform 0.1s ease, color 0.1s ease;
  }
  .copy-btn:hover { color: #111827; }
  .copy-btn:active { transform: scale(0.9); color: #000; }
  .copy-btn svg { width: 14px; height: 14px; pointer-events: none; }

  /* Copy pulse badge */
  .copy-pulse{
    margin-left:6px;
    font-size:11px;
    opacity:0;
    transform: translateY(2px) scale(0.96);
    transition: opacity .18s ease, transform .18s ease;
    user-select:none;
  }
  .copy-pulse.show{
    opacity:1;
    transform: translateY(0) scale(1);
  }
  /* Context-aware pulse colors */
  .copy-pulse.pulse-amber { color:#b45309; } /* amber-700 */
  .copy-pulse.pulse-gray  { color:#374151; } /* gray-700 */

  /* Modal styles */
  #service-plan-btn {
    position:fixed;top:16px;right:16px;z-index:1100;
    padding:8px 14px;background:#2563eb;color:#fff;
    border:none;border-radius:8px;
    box-shadow:0 1px 6px rgba(0,0,0,.12);
    font-size:14px;cursor:pointer;
  }
  #service-plan-modal {
    display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;
    background:rgba(16,23,38,0.32);z-index:1200;
  }
  #service-plan-modal .modal-content {
    background:#fff;border-radius:12px;max-width:600px;
    margin:60px auto;padding:24px 30px;box-shadow:0 4px 24px rgba(0,0,0,.20);
    position:relative;
  }
  #close-service-plan {
    position:absolute;top:16px;right:16px;
    background:none;border:none;font-size:20px;
    cursor:pointer;color:#374151;
  }
  #service-plan-modal details { margin-bottom:12px;}
  #service-plan-modal summary {font-size:16px;cursor:pointer;}
</style>
</head>
<body>
<div id="map"></div>
<div id="status">Starting…</div>
<div id="toast">C.C.</div>

<!-- Service Plan Popup Button -->
<button id="service-plan-btn">Service Plan Info</button>

<!-- Modal Popup -->
<div id="service-plan-modal">
  <div class="modal-content">
    <button id="close-service-plan">×</button>
    <h2 style="margin-top:0;margin-bottom:12px;color:#2563eb;">Service Plan Definitions</h2>
    <details open>
      <summary><b>Express Warranty</b></summary>
      <div style="padding:8px 0 0 0;color:#333;font-size:15px;">
        Express Warranty is only applicable for 12 months after installation. The warranty applies to parts and workmanship but only applies if the customer is not at fault. If the customer is at fault or an external factor has caused the fault (for example, bugs/webs, lightning strikes, water damage, etc) full charges apply (call out, labour and parts).<br><br>
        Customers should still be quoted both ways as it will be up to the technician on site to determine if the fault is warranty related.<br><br>
        <b>Note:</b> If the issue occurs within three months of the installation the job needs to be raised as an Installation Recall. To do this raise a normal service job and change the Job Request to INRE - this job should be left in the open status.
      </div>
    </details>
    <details>
      <summary><b>QSP (Extended Warranty)</b></summary>
      <div style="padding:8px 0 0 0;color:#333;font-size:15px;">
        Extended warranty coverage. Please refer to your contract for exact terms.
      </div>
    </details>
    <details>
      <summary><b>Peace of Mind (POM)</b></summary>
      <div style="padding:8px 0 0 0;color:#333;font-size:15px;">
        Peace of Mind plans include additional servicing and support.
      </div>
    </details>
    <details>
      <summary><b>Comprehensive Extended Warranty</b></summary>
      <div style="padding:8px 0 0 0;color:#333;font-size:15px;">
        Comprehensive extended warranty for selected equipment.
      </div>
    </details>
    <details>
      <summary><b>Equipment Hire/Lease</b></summary>
      <div style="padding:8px 0 0 0;color:#333;font-size:15px;">
        Equipment is supplied as a hire or lease arrangement. Charges may apply for damage or loss.
      </div>
    </details>
  </div>
</div>

<script>
